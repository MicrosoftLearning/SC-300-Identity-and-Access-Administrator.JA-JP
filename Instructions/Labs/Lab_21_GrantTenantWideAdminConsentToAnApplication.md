---
lab:
  title: 21 - アプリケーションに対してテナント全体の管理者の同意を付与する
  learning path: "03"
  module: Module 03 - Implement Access Management for Apps
ms.openlocfilehash: 6618f481c5e25496aef4c5b688976dde9d74cffa
ms.sourcegitcommit: 80c5c0ef60c1d74fcc58c034fe6be67623013cc0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/01/2022
ms.locfileid: "146823230"
---
# <a name="lab-21-grant-tenant-wide-admin-consent-to-an-application"></a>ラボ 21:アプリケーションに対してテナント全体の管理者の同意を付与する

## <a name="lab-scenario"></a>ラボのシナリオ

組織で開発したアプリケーション、または Azure AD テナントに直接登録されているアプリケーションの場合は、Azure portal の [アプリの登録] から、テナント全体の管理者の同意を付与できます。

#### <a name="estimated-time-15-minutes"></a>推定時間:15 分

### <a name="exercise-1---admin-consent"></a>演習 1 - 管理者の同意

#### <a name="task-1---grant-admin-consent-in-app-registrations"></a>タスク 1 - アプリの登録で管理者の同意を付与する

   **警告** - テナント全体の管理者の同意をアプリケーションに付与すると、アプリおよびアプリの発行者に、組織のデータへのアクセスが許可されます。 同意を付与する前に、アプリケーションで要求されているアクセス許可をよく確認してください。

Microsoft Graph API にアプリケーション許可のための管理者の同意を与えるには、グローバル管理者ロールが必要です。

1. 前の演習では、デモ アプリという名前のアプリを作成しました。 必要に応じて、Microsoft Azure で **[Azure Active Directory]** を参照して、 **[アプリの登録]** 、 **[デモ アプリ]** の順に選択します。


2. **[デモ アプリ]** ページで、各 "**アプリケーション (クライアント) ID**" と "**ディレクトリ (テナント) ID**" の値を見つけて、後で使用できるようにコピーして保存します。

    >**注**: **[デモ アプリ]** は、前のラボで作成されます。 このラボの前に、これらのラボを完了してください。

    ![ディレクトリ ID が強調表示されている [デモ アプリ] ページを示す画面イメージ](./media/lp3-mod3-demo-app-directory-id.png)

3. 左側のナビゲーションの **[管理]** で、**[API のアクセス許可]** を選択します。

4. **[構成されたアクセス許可]** で **[管理者の同意の付与]** を選択します。

    ![Contoso に対する管理者の同意の付与が強調表示されている API のアクセス許可ページを示す画面イメージ](./media/lp3-mod3-api-permissions-admin-consent.png)

5. ダイアログ ボックスを確認してから、**[はい]** を選択します。

   **警告** - アプリの登録経由でテナント全体に管理者の同意を与えると、以前にテナント全体に与えられていたアクセス許可が取り消されます。 以前にユーザーが自分で付与したアクセス許可は影響を受けません。

#### <a name="task-2---grant-admin-consent-in-enterprise-apps"></a>タスク 2 - エンタープライズ アプリで管理者の同意を付与する

テナントでアプリケーションが既にプロビジョニングされている場合、"エンタープライズ アプリケーション" を通じて、テナント全体の管理者の同意を付与できます。

1. Microsoft Azure で **[Azure Active Directory] > [エンタープライズ アプリケーション] > [デモ アプリ]** を参照します。

2. **[デモ アプリ]** ページの左側のナビゲーションで、 **[セキュリティ]** の下にある **[アクセス許可]** を選択します。

3. **[アクセス許可]** で **[管理者の同意の付与]** を選択します。

    ![Contoso に対する管理者の同意の付与が強調表示されているデモ アプリのアクセス許可ページを示す画面イメージ](./media/lp3-mod3-grant-admin-consent-in-enterprise-app.png)

   **警告** - アプリの登録経由でテナント全体に管理者の同意を与えると、以前にテナント全体に与えられていたアクセス許可が取り消されます。 以前にユーザーが自分で付与したアクセス許可は影響を受けません。

4. プロンプトが表示されたら、グローバル管理者アカウントを使用してサインインします。

5. **[要求されたアクセス許可]** ダイアログボックスで情報を確認し、**[同意する]** を選択します。


### <a name="exercise-2---azure-ad-identity-governance-settings"></a>演習 2 - Azure AD Identity Governance の設定

#### <a name="task-1---manage-the-lifecycle-of-external-users-in-azure-ad-identity-governance-settings"></a>タスク 1 - Azure AD Identity Governance の設定で外部ユーザーのライフサイクルを管理する

アクセス パッケージ要求が承認されることでディレクトリに招待された外部ユーザーが、アクセス パッケージの割り当てを失ったときに行われる処理を選択できます。 これは、ユーザーがアクセス パッケージの割り当てをすべて放棄した場合、または最後のアクセス パッケージの割り当てが期限切れになった場合に、行われる可能性があります。 既定では、アクセス パッケージの割り当てをすべて失った外部ユーザーは、ディレクトリへのサインインをブロックされます。 30 日後に、ゲスト ユーザー アカウントがディレクトリから削除されます。

1. グローバル管理者として [https://portal.azure.com](https://portal.azure.com) にサインインします。

2. これらのタスクを行うには、グローバル管理者またはユーザー管理者のアカウントが必要です。

3. [Azure Active Directory] を開き、**[Identity Governance]** を選択します。

4. 左側のナビゲーション メニューの **[エンタイトルメント管理]** で、**[設定]** を選択します。

5. 上部のメニューで、**[編集]** を選択します。

    ![[manage the lifecycle of external users]\(外部ユーザーのライフサイクルを管理する\) が強調された Identity Governance の [設定] ページが表示されている画面イメージ。](./media/lp4-mod1-manage-lifcycle-of-ext-users.png)

6. **[Manage the lifecycle of external users]\(外部ユーザーのライフサイクルを管理する\)** セクションで、外部ユーザーに対するさまざまな設定を確認します。

7. 外部ユーザーがアクセス パッケージへの最後の割り当てを失ったときに、そのユーザーによるこのディレクトリへのサインインをブロックする場合は、**[Block external user from signing in to this directory]\(外部ユーザーによるこのディレクトリへのサインインをブロックする\)** を **[はい]** に設定します。

    **注** - ディレクトリへのサインインをブロックされたユーザーは、アクセス パッケージを再要求したり、このディレクトリで追加のアクセス権を要求したりすることができません。 その後、これらのユーザーが他のアクセス パッケージへのアクセスを要求する必要がある場合は、サインインをブロックするように構成しないでください。

9. 外部ユーザーがアクセス パッケージへの最後の割り当てを失ったときに、このディレクトリ内のゲスト ユーザー アカウントを削除する場合は、 **[Remove external user]\(外部ユーザーを削除\)** を **[はい]** に設定します。

    **注** - エンタイトルメント管理を使用すると、エンタイトルメント管理によって招待されたアカウントのみが削除されます。 また、ユーザーがこのディレクトリ内のアクセス パッケージの割り当てではないリソースに追加されていた場合でも、そのユーザーはサインインをブロックされ、このディレクトリから削除されることに注意してください。 アクセス パッケージの割り当てを受け取る前に、ゲストがこのディレクトリ内に存在していた場合は、そのまま残ります。 ただし、ゲストがアクセス パッケージの割り当てによって招待され、招待された後で OneDrive for Business または SharePoint Online サイトにも割り当てられた場合でも、そのゲストは削除されます。

10. このディレクトリ内のゲスト ユーザー アカウントを削除する場合は、削除するまでの日数を設定できます。 アクセス パッケージへの最後の割り当てが失われた直後にゲスト ユーザー アカウントを削除する場合は、 **[Number of days before removing external user from this directory]\(このディレクトリから外部ユーザーを削除するまでの日数\)** を **0** に設定します。

11. 変更を行った場合は、**[保存]** を選択します。

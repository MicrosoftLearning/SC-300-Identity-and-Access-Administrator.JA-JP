---
lab:
  title: 05 - ゲスト ユーザーをディレクトリに追加する
  learning path: '01'
  module: Module 01 - Implement an identity management solution
---

# ラボ 05:ゲスト ユーザーをディレクトリに追加する

### ログインの種類 = Microsoft 365 管理

## ラボのシナリオ

あなたの会社は多くのベンダーと協力していますが、場合によっては、ベンダーのアカウントをゲストとしてディレクトリに追加する必要があります。

#### 推定時間:20 分

### 演習 1 - ゲスト ユーザーをディレクトリに追加する

#### タスク - ゲスト ユーザーを追加する

1. 制限付き管理者ディレクトリ ロールかゲスト招待元ロールが割り当てられたユーザーとして、またはグローバル管理者として、 [https://entra.Microsoft.com](https://entra.microsoft.com)  にサインインします。

2.  **[ID]** を選択します。

3.  **[ユーザー]** で、 **[すべてのユーザー]** を選択します。

4.  **[+ 新しいユーザー]** を選択します。

5. [新しいユーザー] メニューで、 **[外部ユーザーの招待]** を選択してから、ゲスト ユーザーの情報を追加します。

    **注** - グループのメール アドレスはサポートされていません。個人のメール アドレスを入力してください。 また、一部の電子メール プロバイダーでは、ユーザーはプラス記号 (+) と追加テキストを電子メール アドレスに付け加えて、受信ボックスのフィルター処理などに役立てることができます。 ただし、現在、Microsoft Entra ID ではメール アドレスのプラス記号はサポートされていません。 配信の問題を回避するために、プラス記号と、それに続く @ 記号より前の任意の文字を含めません。

6. 電子メール アドレスを入力します (例: **sc300externaluser1@sc300email.com** )。

7. **[プロパティ]** タブを選択します。

8. [ユーザー] ページで、アカウントが一覧表示されていることを確認し、 **[ユーザーの種類]** 列に **[ゲスト]** が表示されていることを確認します。

9. 完了したら、**[確認と招待]**、**[招待]** の順に選択します。


招待を送信すると、ユーザー アカウントがディレクトリにゲストとして自動的に追加されます。


### 演習 2 - ゲスト ユーザーを一括で招待する

#### タスク 1 - ユーザーの一括招待

最近では、他社との提携が行われています。 当面は、パートナー企業の従業員がゲストとして追加されます。 複数のゲスト ユーザーを一度にインポートできるようにする必要があります。

1. グローバル管理者として [https://entra.microsoft.com](https://entra.microsoft.com) にサインインします。

2. ナビゲーション ウィンドウで、**[ID]** を選択します。

3. **[ユーザー]** で **[すべてのユーザー]** を選びます。

4. [ユーザー] ページのメニューで、 **[一括操作]、[一括招待]** の順に選択します。

   ![「一括操作」と「一括招待」のメニュー オプションが強調表示された「すべてのユーザー」ページを表示する画面イメージ](./media/lp1-mod3-bulk-invite-option.png)

5. [ユーザー一括招待] ウィンドウで、招待プロパティを持つサンプル CSV テンプレートへの **[ダウンロード]** を選択します。

6. エディターを使用して CSV ファイルを表示し、テンプレートを確認します。

7. この .csv テンプレートを開いて、ゲスト ユーザーごとに 1 行追加します。 必要な値は次のとおりです。

    - **招待するメール アドレス** - 招待が送信されるユーザー
    - **リダイレクト URL** - 招待されたユーザーが招待を承認した後に転送される URL。

    ![ゲスト一括招待のテンプレート CSV の例を表示する画面イメージ](./media/lp1-mod3-template-csv.png)

**ラボのヒント** - スクリーンショットに一覧表示されているユーザーとテンプレート ファイルは例であり、実際には存在しません。  この機能を完全にテストするには、実際のユーザーを追加する必要があります。

8. ファイルを保存します。

9. [ユーザー一括招待] ページの **[csv ファイルをアップロードします]** で、そのファイルを参照します。

     **注** - ファイルを選択すると、.csv ファイルの検証が開始されます。

10. ファイルの内容が検証された後、**[ファイルが正常にアップロードされました]** と表示されます。 エラーが存在する場合は、ジョブを送信する前にそれらを修正する必要があります。

    ![「ファイルが正常にアップロードされました」というメッセージが強調表示された「ユーザー一括招待」を表示する画面イメージ](./media/lp1-mod3-bulk-invite-users-upload-csv.png)

11. ファイルが検証に合格したら、 **[送信]** を選択して、招待を追加する Azure の一括操作を開始します。

12. ジョブの状態を表示するには、 **[各操作の状態を表示するには、ここを選択します]** を選択します。 または、 [アクティビティ] セクションの **[一括操作の結果]** を選択します。 一括操作に含まれる各行の項目の詳細については、 **[成功数]** 、 **[失敗数]** 、 **[要求数合計]** の各列の値を選択してください。 エラーが発生した場合、その理由が表示されます。

    ![一括操作の結果を表示する画面イメージ](./media/lp1-mod3-bulk-operations-results.png)

13. ジョブが完了すると、一括操作が成功したという通知が表示されます。

#### タスク 2 - PowerShell を使用してゲスト ユーザーを招待する

1. PowerShell を開きます。 これを行うには、Windows で PowerShell を検索します。

**注** - このラボを機能させるためには、PowerShell バージョン 7.2 以降が必要です。  PowerShell が開くと、画面の上部にバージョンが表示されます。古いバージョンを実行している場合は更新してください。そうしないと、ラボのこの部分が失敗します。

**ラボのヒント** - ラボ環境の TouchType 機能には、PowerShell への入力に関する問題があります。 ラボでメモ帳を起動してから、TouchType を使用して PowerShell の指示をメモ帳に読み込む場合は、**切り取り/貼り付け**を使用して、入力せずに PowerShell に入力できます。

2. 以前に使用したことがない場合は、Microsoft.Graph PowerShell モジュールをインストールする必要があります。  次の 2 つのコマンドを実行し、確認を求められたら Y キーを押します。

    ```
    Install-Module Microsoft.Graph -Scope CurrentUser -Verbose
    ```
3. Microsoft.Graph モジュールがインストールされていることを確認します。

    ```
    Get-InstalledModule Microsoft.Graph
    ```
    

4. 次に、次を実行して Azure にログインする必要があります。  

    ```
    Connect-MgGraph -Scopes "User.ReadWrite.All"
    ``` 
    Edge ブラウザーが開き、サインインするように求められます。  MOD 管理者アカウントを使用して接続します。  同意ボックスにチェックを入れ、アクセス許可リクエストに同意して、ブラウザー ウィンドウを閉じます。

5. 外部ユーザーのメールとリダイレクトの値を設定します。

    ```
    Import-Module Microsoft.Graph.Identity.SignIns
    
    $params = @{
        invitedUserEmailAddress = "admin@fabrikam.com"
        inviteRedirectUrl = "https://myapp.contoso.com"
    }
    ```

6. 外部ユーザーを招待する MgInvitation コマンドを送信します。

    ```
    New-MgInvitation -BodyParameter $params
    ```

7. この時点で PowerShell を閉じることができます。
    
Microsoft Entra 管理センター、Microsoft 365 管理センター、csv ファイルによる一括招待、PowerShell コマンドを利用してユーザーを招待する方法について説明しました。  Microsoft Entra 管理センターに移動し、[すべてのユーザー] で、管理者が外部ユーザーとして追加されたことを確認できます。
